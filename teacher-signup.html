<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teacher Sign Up</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #C9E4DE;
      padding: 20px;
      color: black;
      transition: direction 0.3s ease;
      margin: 0;
    }
    h1 {
      text-align: center;
      color: black;
    }
    form {
      max-width: 600px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(27, 73, 101, 0.2);
      color: black;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: black;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #ccc;
      color: black;
      font-size: 1rem;
      outline-offset: 2px;
    }
    input:focus, select:focus, button:focus {
      outline: 2px solid #557A95;
      outline-offset: 3px;
    }
    button {
      margin-top: 20px;
      background-color: #FAEDCB;
      color: black;
      border: none;
      padding: 12px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-weight: bold;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #e6d8a5;
    }
    #file-name {
      margin-top: 5px;
      font-style: italic;
      color: black;
      min-height: 1.2em;
    }
    #file-name[aria-live] {
      /* For screen readers */
    }
    #lang-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #FAEDCB;
      color: black;
      border: none;
      padding: 8px 14px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      max-width: 120px;
      white-space: nowrap;
      user-select: none;
      z-index: 1000;
      transition: background-color 0.3s ease;
    }
    #lang-toggle:hover {
      background-color: #e6d8a5;
    }
    #error-message {
      color: red;
      font-weight: bold;
      margin-top: 10px;
      text-align: center;
    }
  </style>
</head>
<body>

<button id="lang-toggle" aria-label="Toggle Language">عربي</button>
<h1 data-en="Teacher Sign Up" data-ar="تسجيل المعلمين">Teacher Sign Up</h1>

<form id="signup-form" enctype="multipart/form-data" novalidate>
  <label for="fullname" data-en="Full Name" data-ar="الاسم الكامل">Full Name</label>
  <input id="fullname" name="fullname" type="text" required
         data-placeholder-en="Enter your full name" data-placeholder-ar="أدخل اسمك الكامل" />

  <label for="email" data-en="Email" data-ar="البريد الإلكتروني">Email</label>
  <input id="email" name="email" type="email" required
         data-placeholder-en="Enter your email" data-placeholder-ar="أدخل بريدك الإلكتروني" />

  <label for="password" data-en="Password" data-ar="كلمة المرور">Password</label>
  <input id="password" name="password" type="password" required minlength="6"
         data-placeholder-en="Enter password" data-placeholder-ar="أدخل كلمة المرور" />

  <label for="whatsapp" data-en="WhatsApp Number" data-ar="رقم الواتساب">WhatsApp Number</label>
  <input id="whatsapp" name="whatsapp" type="text" required pattern="^\+?[0-9]{7,15}$"
         data-placeholder-en="e.g. +971501234567" data-placeholder-ar="مثال: +971501234567" />

  <label for="bank" data-en="Bank Name" data-ar="اسم البنك">Bank Name</label>
  <input id="bank" name="bank" type="text" required
         data-placeholder-en="Enter bank name" data-placeholder-ar="أدخل اسم البنك" />

  <label for="iban" data-en="IBAN Number" data-ar="رقم الآيبان">IBAN Number</label>
  <input id="iban" name="iban" type="text" required pattern="^[A-Z0-9]{15,34}$"
         data-placeholder-en="Enter IBAN" data-placeholder-ar="أدخل رقم الآيبان" />

  <label for="subject-select" data-en="Subject" data-ar="المادة">Subject</label>
  <select name="subject" required id="subject-select"></select>

  <label for="grade-select" data-en="Grade" data-ar="الصف الدراسي">Grade</label>
  <select name="grade" required id="grade-select"></select>

  <label for="gender-select" data-en="Gender" data-ar="اللقب">Gender</label>
  <select name="gender" required id="gender-select"></select>

  <label for="certificate-input" data-en="Upload Certificate" data-ar="تحميل الشهادة">Upload Certificate</label>
  <input id="certificate-input" name="certificate" type="file" accept=".pdf,.jpg,.jpeg,.png" aria-describedby="file-name" required />
  <div id="file-name" aria-live="polite" aria-atomic="true"></div>

  <button type="submit" data-en="Sign Up" data-ar="تسجيل">Sign Up</button>
  <div id="error-message"></div>
</form>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-analytics.js";
  import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-auth.js";
  import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-storage.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBF_HWMbMUaetcluFgcPPICjOZt2MBtHro",
    authDomain: "teacher-signup.firebaseapp.com",
    projectId: "teacher-signup",
    storageBucket: "teacher-signup.appspot.com",
    messagingSenderId: "176055526981",
    appId: "1:176055526981:web:10453a63f0e5b92888652c",
    measurementId: "G-4FR5EWKCT0"
  };

  const app = initializeApp(firebaseConfig);
  getAnalytics(app);

  const auth = getAuth(app);
  const storage = getStorage(app);
  const db = getFirestore(app);

  // Language stuff from your code (excluded here for brevity)

  // Elements
  const form = document.getElementById("signup-form");
  const fileInput = document.getElementById("certificate-input");
  const fileNameDisplay = document.getElementById("file-name");
  const errorMessage = document.getElementById("error-message");

  fileInput.addEventListener("change", () => {
    if (fileInput.files.length > 0) {
      fileNameDisplay.textContent = fileInput.files[0].name;
    } else {
      fileNameDisplay.textContent = "";
    }
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    errorMessage.textContent = "";

    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    // Get form values
    const fullname = form.fullname.value.trim();
    const email = form.email.value.trim();
    const password = form.password.value;
    const whatsapp = form.whatsapp.value.trim();
    const bank = form.bank.value.trim();
    const iban = form.iban.value.trim().toUpperCase();
    const subject = form.subject.value;
    const grade = form.grade.value;
    const gender = form.gender.value;
    const certificateFile = fileInput.files[0];

    if (!certificateFile) {
      errorMessage.textContent = currentLang === 'ar' ? "يرجى تحميل الشهادة." : "Please upload your certificate.";
      return;
    }

    try {
      // Create user with email and password
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      // Upload certificate file to storage
      const certStorageRef = storageRef(storage, `certificates/${user.uid}/${certificateFile.name}`);
      await uploadBytes(certStorageRef, certificateFile);
      const certificateURL = await getDownloadURL(certStorageRef);

      // Save user info in Firestore
      await setDoc(doc(db, "teachers", user.uid), {
        fullname,
        email,
        whatsapp,
        bank,
        iban,
        subject,
        grade,
        gender,
        certificateURL,
        createdAt: new Date().toISOString()
      });

      // Redirect to subscription page
      window.location.href = "subscription.html";

    } catch (error) {
      // Show error message
      let msg = error.message || "Error occurred. Please try again.";
      if(error.code) {
        // Customize common errors for better UX
        if(error.code === "auth/email-already-in-use") {
          msg = currentLang === "ar" ? "البريد الإلكتروني مستخدم بالفعل." : "Email is already in use.";
        } else if(error.code === "auth/invalid-email") {
          msg = currentLang === "ar" ? "البريد الإلكتروني غير صالح." : "Invalid email address.";
        } else if(error.code === "auth/weak-password") {
          msg = currentLang === "ar" ? "كلمة المرور ضعيفة. استخدم 6 أحرف على الأقل." : "Weak password. Use at least 6 characters.";
        }
      }
      errorMessage.textContent = msg;
    }
  });

  // Populate selects with your existing data (omitted here for brevity)
  // ... keep your fillSelects(), setLanguage(), langToggle event, etc.

</script>
<script>
  // Your existing JS for language toggle and select populating here
  // (Please copy your current language toggle and select fill logic here)
</script>
</body>
</html>
