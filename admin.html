<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Dashboard</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #eef2f7;
    margin: 0;
    padding: 20px;
    color: #222;
  }

  /* Container */
  .container {
    max-width: 1200px;
    margin: 0 auto;
  }

  /* Login form */
  #loginSection {
    max-width: 320px;
    margin: 100px auto;
    background: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    text-align: center;
  }

  #loginSection input[type="password"] {
    width: 100%;
    padding: 10px;
    font-size: 1.1rem;
    margin-bottom: 15px;
    border-radius: 5px;
    border: 1px solid #ccc;
  }

  #loginSection button {
    width: 100%;
    padding: 10px;
    background-color: #0077b6;
    color: white;
    border: none;
    border-radius: 5px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  #loginSection button:hover {
    background-color: #005f87;
  }

  /* Admin dashboard */
  #adminContent {
    display: none;
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
  }

  h1 {
    color: #0077b6;
    margin-bottom: 10px;
  }

  .counters {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
    justify-content: center;
  }
  .counter {
    background: #caf0f8;
    padding: 15px 25px;
    border-radius: 8px;
    font-weight: 700;
    color: #023e8a;
    min-width: 150px;
  }

  /* Table styling */
  table {
    width: 100%;
    border-collapse: collapse;
  }

  th, td {
    padding: 12px 15px;
    border: 1px solid #ddd;
    text-align: center;
    vertical-align: middle;
  }

  th {
    background-color: #0077b6;
    color: white;
    font-weight: 600;
  }

  tr:nth-child(even) {
    background-color: #f9fafd;
  }

  /* Status badges */
  .status-badge {
    padding: 6px 12px;
    border-radius: 20px;
    color: white;
    font-weight: 600;
    user-select: none;
  }

  .approved {
    background-color: #2a9d8f;
  }

  .pending {
    background-color: #e76f51;
  }

  /* Buttons */
  .approve-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .approve-btn.approve {
    background-color: #2a9d8f;
  }

  .approve-btn.approve:hover {
    background-color: #207065;
  }

  .approve-btn.undo {
    background-color: #e76f51;
  }

  .approve-btn.undo:hover {
    background-color: #ba4a38;
  }

  /* Image previews */
  img.preview {
    max-width: 80px;
    max-height: 60px;
    border-radius: 5px;
    object-fit: contain;
    box-shadow: 0 0 6px rgba(0,0,0,0.1);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .counters {
      flex-direction: column;
      align-items: center;
    }

    table, th, td {
      font-size: 14px;
    }

    img.preview {
      max-width: 60px;
      max-height: 45px;
    }
  }

  /* No teachers message */
  #noTeachersMsg {
    text-align: center;
    margin-top: 25px;
    font-style: italic;
    color: #555;
  }
</style>
</head>
<body>

<div class="container">

  <!-- Login Section -->
  <section id="loginSection" aria-label="Admin Login">
    <h2>Admin Login</h2>
    <input
      type="password"
      id="adminPasswordInput"
      placeholder="Enter admin password"
      aria-required="true"
      autocomplete="off"
    />
    <button id="loginBtn" aria-label="Login to admin dashboard">Login</button>
    <p id="loginError" style="color: #e76f51; margin-top: 10px; display: none;">Incorrect password. Try again.</p>
  </section>

  <!-- Admin Dashboard -->
  <section id="adminContent" aria-label="Admin Dashboard">
    <h1>Admin Dashboard</h1>
    <p>Welcome, Admin. You have access to teacher data and controls.</p>

    <div class="counters" aria-live="polite" aria-atomic="true">
      <div class="counter" id="parentCount">Parent/Student Accounts: 0</div>
      <div class="counter" id="teacherCount">Teacher Accounts: 0</div>
      <div class="counter" id="visitCount">Website Visits: 0</div>
    </div>

    <table id="teachersTable" aria-label="Teachers List">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Email</th>
          <th scope="col">University Certificate</th>
          <th scope="col">Payment Receipt</th>
          <th scope="col">Status</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <p id="noTeachersMsg" style="display:none;">No teachers signed up yet.</p>
  </section>

</div>

<script>
(() => {
  "use strict";

  // Config - change password here
  const ADMIN_PASSWORD = "SJ";

  // Elements
  const loginSection = document.getElementById("loginSection");
  const adminContent = document.getElementById("adminContent");
  const loginBtn = document.getElementById("loginBtn");
  const passwordInput = document.getElementById("adminPasswordInput");
  const loginError = document.getElementById("loginError");

  const parentCountEl = document.getElementById("parentCount");
  const teacherCountEl = document.getElementById("teacherCount");
  const visitCountEl = document.getElementById("visitCount");

  const teachersTableBody = document.querySelector("#teachersTable tbody");
  const noTeachersMsg = document.getElementById("noTeachersMsg");

  // Escape HTML for security
  function escapeHTML(str) {
    if (!str) return "";
    return str.replace(/[&<>"']/g, (m) => ({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;", "'":"&#39;"}[m]));
  }

  // Load data from localStorage safely
  function loadData(key) {
    try {
      const data = localStorage.getItem(key);
      if (!data) return null;
      return JSON.parse(data);
    } catch (err) {
      console.error(`Failed to parse localStorage item "${key}":`, err);
      return null;
    }
  }

  // Save data to localStorage
  function saveData(key, data) {
    try {
      localStorage.setItem(key, JSON.stringify(data));
    } catch (err) {
      console.error(`Failed to save localStorage item "${key}":`, err);
    }
  }

  // Render counts
  function renderCounts() {
    const parents = loadData("parents") || [];
    const teachers = loadData("teachers") || [];
    const visits = Number(localStorage.getItem("visitCount") || 0);

    parentCountEl.textContent = `Parent/Student Accounts: ${parents.length}`;
    teacherCountEl.textContent = `Teacher Accounts: ${teachers.length}`;
    visitCountEl.textContent = `Website Visits: ${visits}`;
  }

  // Render teachers table with certificate and payment images
  function renderTeachersTable() {
    const teachers = loadData("teachers") || [];
    const certificates = loadData("certificates") || {}; // object: email -> cert URL
    const payments = loadData("payments") || {};         // object: email -> payment receipt URL

    teachersTableBody.innerHTML = "";

    if (teachers.length === 0) {
      noTeachersMsg.style.display = "block";
      return;
    } else {
      noTeachersMsg.style.display = "none";
    }

    teachers.forEach((teacher, index) => {
      const { name, email, approved } = teacher;
      const certURL = certificates[email] || "";
      const paymentURL = payments[email] || "";

      // Create row
      const tr = document.createElement("tr");

      // Name
      const tdName = document.createElement("td");
      tdName.textContent = name || "-";
      tr.appendChild(tdName);

      // Email
      const tdEmail = document.createElement("td");
      tdEmail.textContent = email || "-";
      tr.appendChild(tdEmail);

      // Certificate Image
      const tdCert = document.createElement("td");
      if (certURL) {
        const imgCert = document.createElement("img");
        imgCert.src = certURL;
        imgCert.alt = `Certificate of ${name}`;
        imgCert.className = "preview";
        tdCert.appendChild(imgCert);
      } else {
        tdCert.textContent = "Not uploaded";
        tdCert.style.color = "#888";
      }
      tr.appendChild(tdCert);

      // Payment Receipt Image
      const tdPayment = document.createElement("td");
      if (paymentURL) {
        const imgPay = document.createElement("img");
        imgPay.src = paymentURL;
        imgPay.alt = `Payment Receipt of ${name}`;
        imgPay.className = "preview";
        tdPayment.appendChild(imgPay);
      } else {
        tdPayment.textContent = "Not uploaded";
        tdPayment.style.color = "#888";
      }
      tr.appendChild(tdPayment);

      // Status
      const tdStatus = document.createElement("td");
      const statusSpan = document.createElement("span");
      statusSpan.className = `status-badge ${approved ? "approved" : "pending"}`;
      statusSpan.textContent = approved ? "Approved" : "Pending";
      tdStatus.appendChild(statusSpan);
      tr.appendChild(tdStatus);

      // Action (approve / undo)
      const tdAction = document.createElement("td");
      const btn = document.createElement("button");
      btn.className = `approve-btn ${approved ? "undo" : "approve"}`;
      btn.textContent = approved ? "Undo Approve" : "Approve";
      btn.setAttribute("aria-label", `${btn.textContent} ${name}`);

      btn.addEventListener("click", () => {
        toggleApproval(index);
      });

      tdAction.appendChild(btn);
      tr.appendChild(tdAction);

      teachersTableBody.appendChild(tr);
    });
  }

  // Toggle approval status and save
  function toggleApproval(index) {
    const teachers = loadData("teachers") || [];
    if (!teachers[index]) return;

    teachers[index].approved = !teachers[index].approved;
    saveData("teachers", teachers);

    renderTeachersTable();
  }

  // Handle login
  loginBtn.addEventListener("click", () => {
    const entered = passwordInput.value.trim();
    if (entered === ADMIN_PASSWORD) {
      loginSection.style.display = "none";
      adminContent.style.display = "block";
      loginError.style.display = "none";
      passwordInput.value = "";
      renderCounts();
      renderTeachersTable();
    } else {
      loginError.style.display = "block";
      passwordInput.value = "";
      passwordInput.focus();
    }
  });

  // Optional: allow Enter key on password input
  passwordInput.addEventListener("keyup", (e) => {
    if (e.key === "Enter") {
      loginBtn.click();
    }
  });

  // On page load, check if admin is logged in (optional)
  // For simplicity, no persistent login now

})();
</script>

</body>
</html>
