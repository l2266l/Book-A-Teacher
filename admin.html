<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
    button { padding: 5px 10px; cursor: pointer; }
    a { color: blue; text-decoration: underline; }
  </style>
</head>
<body>

<h1>Admin Dashboard</h1>

<!-- Login section -->
<div id="loginDiv">
  <label>Password: <input type="password" id="password" /></label>
  <button onclick="login()">Login</button>
  <p id="error" style="color:red;"></p>
</div>

<!-- Dashboard section -->
<div id="dashboard" class="hidden">
  <h2>Summary</h2>
  <p>Parents: <span id="parentCount"></span></p>
  <p>Teachers: <span id="teacherCount"></span></p>
  <p>Site visits: <span id="visitCount"></span></p>

  <h2>Teachers</h2>
  <table>
    <thead>
      <tr>
        <th>Name</th><th>Email</th><th>Subject</th><th>University Certificate</th><th>Payment Receipt</th><th>Approved</th><th>Action</th>
      </tr>
    </thead>
    <tbody id="teacherList"></tbody>
  </table>
</div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDGoROxKGm8Nj9EDqFw95FuF0sRgCahQUg",
    authDomain: "smartstudents-64d4c.firebaseapp.com",
    databaseURL: "https://smartstudents-64d4c-default-rtdb.firebaseio.com",
    projectId: "smartstudents-64d4c",
    storageBucket: "smartstudents-64d4c.appspot.com",
    messagingSenderId: "179949719475",
    appId: "1:179949719475:web:b417b3578fdec15f66c3f5"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const storage = firebase.storage();

  let visitCount = 0; // Optional counter

  function login() {
    const pw = document.getElementById('password').value;
    if (pw === 'SJ') {
      document.getElementById('loginDiv').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      loadDashboard();
    } else {
      document.getElementById('error').textContent = 'Wrong password!';
    }
  }

  function loadDashboard() {
    // Count parents
    db.ref('parentUsers').once('value', snapshot => {
      const parents = snapshot.val() || {};
      document.getElementById('parentCount').textContent = Object.keys(parents).length;
    });

    // Count teachers and display them
    db.ref('teacherUsers').once('value', snapshot => {
      const teachers = snapshot.val() || {};
      const tbody = document.getElementById('teacherList');
      tbody.innerHTML = '';
      let count = 0;

      Object.entries(teachers).forEach(([id, teacher]) => {
        count++;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${teacher.name || ''}</td>
          <td>${teacher.email || ''}</td>
          <td>${teacher.subject || ''}</td>
          <td><a href="${teacher.uniCertificate || '#'}" target="_blank">View</a></td>
          <td><a href="${teacher.paymentReceipt || '#'}" target="_blank">View</a></td>
          <td>${teacher.approved ? 'Yes' : 'No'}</td>
          <td>
            <button onclick="toggleApproval('${id}', ${teacher.approved})">
              ${teacher.approved ? 'Undo' : 'Approve'}
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById('teacherCount').textContent = count;
    });

    // Fake site visits
    document.getElementById('visitCount').textContent = visitCount;
  }

  function toggleApproval(id, approved) {
    db.ref('teacherUsers/' + id).update({ approved: !approved })
      .then(loadDashboard);
  }
</script>

</body>
</html>
